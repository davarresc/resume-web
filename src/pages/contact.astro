---
import { Icon } from "astro-icon/components";
import Layout from "../layouts/Layout.astro";
import { Config } from "../utils/config";

const labelStyle =
  "block uppercase tracking-wide text-gray-700 dark:text-gray-100 text-xs font-bold mb-2";
const inputStyle =
  "appearance-none block w-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-100 border border-gray-200 dark:border-gray-500 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white dark:focus:bg-gray-600 focus:border-gray-500";

const SITE_KEY = Config.RECAPTCHA_V3.public;
---

<Layout title={Astro.locals.t("contact.title")}>
  <div
    class="max-w-[840px] w-full mx-auto animate-fade-in-up flex flex-col gap-12 px-4 lg:px-0"
  >
    <h1
      class="text-2xl font-bold text-gray-900 dark:text-gray-100 underline dark:underline-gray-100 underline-offset-8"
    >
      {Astro.locals.t("common.nav.contact")}
    </h1>

    <!-- Success alert -->
    <div
      class="alert-success flex items-center p-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400 gap-2 hidden"
      role="alert"
    >
      <Icon name="tabler:check" class="w-[24px] h-[24px] hidden lg:flex" />
      <span class="sr-only">Info</span>
      <div>
        <span class="font-bold">
          {Astro.locals.t("contact.messages.success.title")}
        </span>
        {Astro.locals.t("contact.messages.success.description")}
      </div>
    </div>

    <!-- Error alert -->
    <div
      class="alert-error flex items-center p-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400 gap-2 hidden"
      role="alert"
    >
      <Icon name="tabler:check" class="w-[24px] h-[24px] hidden lg:flex" />
      <span class="sr-only">Info</span>
      <div>
        <span class="font-bold">
          {Astro.locals.t("contact.messages.error.title")}
        </span>
        {Astro.locals.t("contact.messages.error.description")}
      </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-14">
      <!-- Contact form -->
      <div class="flex w-full justify-center lg:justify-start">
        <form method="POST" name="cForm" data-key={SITE_KEY}>
          <div class="flex flex-wrap -mx-3 mb-6">
            <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
              <label class={labelStyle} for="firstName">
                {Astro.locals.t("contact.form.fields.firstName")}
                <sup class="text-red">*</sup>
              </label>
              <input
                class={inputStyle}
                id="firstName"
                name="firstName"
                type="text"
                required
              />
            </div>
            <div class="w-full md:w-1/2 px-3">
              <label class={labelStyle} for="lastName">
                {Astro.locals.t("contact.form.fields.lastName")}
                <sup>*</sup>
              </label>
              <input
                class={inputStyle}
                id="lastName"
                name="lastName"
                type="text"
                required
              />
            </div>
          </div>

          <div class="flex flex-wrap -mx-3 mb-6">
            <div class="w-full px-3">
              <label class={labelStyle} for="email">
                {Astro.locals.t("contact.form.fields.email")}
                <sup>*</sup>
              </label>
              <input
                class={inputStyle}
                id="email"
                name="email"
                type="email"
                required
              />
            </div>
          </div>

          <div class="flex flex-wrap -mx-3 mb-6">
            <div class="w-full px-3">
              <label class={labelStyle} for="message">
                {Astro.locals.t("contact.form.fields.message")}
                <sup>*</sup>
              </label>
              <textarea
                rows="5"
                class={inputStyle}
                id="message"
                name="message"
                required></textarea>
            </div>
          </div>

          <input type="hidden" name="gToken" />

          <div class="flex items-center justify-between">
            <button
              class="group/submit flex justify-center w-full bg-transparent hover:bg-gray-600 active:bg-gray-600 text-gray-900 font-semibold hover:text-gray-100 active:text-gray-100 py-2 px-4 border border-gray-500 hover:border-transparent active:border-transparent rounded cursor-pointer dark:text-gray-100 gap-3 disabled:cursor-default disabled:opacity-60 disabled:pointer-events-none"
              type="submit"
            >
              <div role="status" class="hidden group-disabled/submit:block">
                <Icon
                  name="tabler:loader-2"
                  class="w-[24px] h-[24px] animate-spin"
                />
                <span class="sr-only">Loading...</span>
              </div>
              <Icon
                name="tabler:send"
                class="w-[24px] h-[24px] group-disabled/submit:hidden"
              />
              {Astro.locals.t("contact.form.buttons.submit")}
            </button>
          </div>
        </form>
      </div>

      <div class="flex w-full gap-4 justify-center items-center lg:hidden">
        <hr class="border-t border-black dark:border-gray-100 w-[24px]" />
        <span
          class="text-lg text-gray-900 dark:text-gray-100 font-bold uppercase"
        >
          {Astro.locals.t("common.or")}
        </span>
        <hr class="border-t border-black dark:border-gray-100 w-[24px]" />
      </div>

      <!-- Contact info -->
      <div
        class="flex flex-col lg:gap-4 items-center lg:items-start justify-between"
      >
        <p
          class="text-base font-bold text-gray-900 dark:text-gray-100 hidden lg:flex"
        >
          {Astro.locals.t("contact.phone")}:
        </p>
        <p class="group flex gap-2 ps-5">
          <Icon name="tabler:phone" class="w-[30px] h-[30px]" />
          <a href={"tel:" + Astro.locals.t("common.phone")}>
            {Astro.locals.t("common.phone")}
          </a>
        </p>
        <p
          class="text-base font-bold text-gray-900 dark:text-gray-100 hidden lg:flex"
        >
          {Astro.locals.t("contact.email")}:
        </p>
        <p class="group flex gap-2 ps-5">
          <Icon name="tabler:at" class="w-[30px] h-[30px]" />
          <a href={"mailto:" + Astro.locals.t("common.email")}>
            {Astro.locals.t("common.email")}
          </a>
        </p>
        <img
          src="/images/code.jpg"
          class="rounded-box max-w-[300px] hidden lg:flex"
        />
      </div>
    </div>
  </div>

  <script>
    import { handleSubmit, displayAlertError } from "../scripts/pages/contact";

    const form = document.querySelector("[name='cForm']") as HTMLFormElement;
    const tInput = form.querySelector('[name="gToken"]') as HTMLInputElement;

    form.addEventListener("submit", async (event) => {
      // eslint-disable-next-line @typescript-eslint/no-explicit-any
      const grecaptcha = (globalThis as any).grecaptcha;
      event.preventDefault();

      // Load grecaptcha
      await new Promise((resolve) => {
        if (grecaptcha) grecaptcha.ready(resolve);
        else document.addEventListener("grecaptchaLoaded", resolve);
      });

      try {
        const publicKey = form.dataset.key;
        const token = await grecaptcha.execute(publicKey, { action: "submit" });
        tInput.value = token;

        handleSubmit(form, event);
      } catch (err) {
        console.error(err);
        displayAlertError();
      }
    });
  </script>
</Layout>

<script
  src={`https://www.google.com/recaptcha/api.js?render=${SITE_KEY}`}
  async
  defer></script>
